import{n as I,z as M,C as g}from"../app.0af5963c.js";var v={exports:{}};(function(r,a){(function(o,h){r.exports=h()})(I,function(){var o={};o.dom={},o.dom.g=function(t){return typeof t=="string"||t instanceof String?document.getElementById(t):t&&t.nodeName&&(t.nodeType==1||t.nodeType==9)?t:null},o.g=o.G=o.dom.g,o.lang=o.lang||{},o.lang.isString=function(t){return Object.prototype.toString.call(t)=="[object String]"},o.isString=o.lang.isString,o.dom._g=function(t){return o.lang.isString(t)?document.getElementById(t):t},o._g=o.dom._g,o.dom.getDocument=function(t){return t=o.dom.g(t),t.nodeType==9?t:t.ownerDocument||t.document},o.browser=o.browser||{},o.browser.ie=o.ie=/msie (\d+\.\d+)/i.test(navigator.userAgent)?document.documentMode||+RegExp.$1:void 0,o.dom.getComputedStyle=function(t,e){t=o.dom._g(t);var i=o.dom.getDocument(t),n;return i.defaultView&&i.defaultView.getComputedStyle&&(n=i.defaultView.getComputedStyle(t,null),n)?n[e]||n.getPropertyValue(e):""},o.dom._styleFixer=o.dom._styleFixer||{},o.dom._styleFilter=o.dom._styleFilter||[],o.dom._styleFilter.filter=function(t,e,i){for(var n=0,s=o.dom._styleFilter,l;l=s[n];n++)(l=l[i])&&(e=l(t,e));return e},o.string=o.string||{},o.string.toCamelCase=function(t){return t.indexOf("-")<0&&t.indexOf("_")<0?t:t.replace(/[-_][^-_]/g,function(e){return e.charAt(1).toUpperCase()})},o.dom.getStyle=function(t,e){var i=o.dom;t=i.g(t),e=o.string.toCamelCase(e);var n=t.style[e]||(t.currentStyle?t.currentStyle[e]:"")||i.getComputedStyle(t,e);if(!n){var s=i._styleFixer[e];s&&(n=s.get?s.get(t):o.dom.getStyle(t,s))}return(s=i._styleFilter)&&(n=s.filter(e,n,"get")),n},o.getStyle=o.dom.getStyle,o.dom._NAME_ATTRS=function(){var t={cellpadding:"cellPadding",cellspacing:"cellSpacing",colspan:"colSpan",rowspan:"rowSpan",valign:"vAlign",usemap:"useMap",frameborder:"frameBorder"};return o.browser.ie<8?(t.for="htmlFor",t.class="className"):(t.htmlFor="for",t.className="class"),t}(),o.dom.setAttr=function(t,e,i){return t=o.dom.g(t),e=="style"?t.style.cssText=i:(e=o.dom._NAME_ATTRS[e]||e,t.setAttribute(e,i)),t},o.setAttr=o.dom.setAttr,o.dom.setAttrs=function(t,e){t=o.dom.g(t);for(var i in e)o.dom.setAttr(t,i,e[i]);return t},o.setAttrs=o.dom.setAttrs,o.dom.create=function(t,e){var i=document.createElement(t),n=e||{};return o.dom.setAttrs(i,n)},o.object=o.object||{},o.extend=o.object.extend=function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);return t};var h=function(t,e,i){try{BMap}catch{throw Error("Baidu Map JS API is not ready yet!")}!e||e.length<1||(this._map=t,this._path=e,this.i=0,this._setTimeoutQuene=[],this._projection=this._map.getMapType().getProjection(),this._opts={icon:null,speed:4e3,defaultContent:"",showInfoWindow:!1},this._setOptions(i),this._rotation=0,!this._opts.icon instanceof BMap.Icon&&(this._opts.icon=defaultIcon))};h.prototype._setOptions=function(t){if(!!t)for(var e in t)t.hasOwnProperty(e)&&(this._opts[e]=t[e])},h.prototype.start=function(){var t=this,e=t._path.length;if(this._opts.onstart&&this._opts.onstart(t),t.i&&t.i<e-1)if(t._fromPause)t._fromStop||t._moveNext(++t.i);else return;else!t._marker&&t._addMarker(),t._timeoutFlag=setTimeout(function(){!t._overlay&&t._addInfoWin(),t._moveNext(t.i)},400);this._fromPause=!1,this._fromStop=!1},h.prototype.stop=function(){this.i=0,this._fromStop=!0,clearInterval(this._intervalFlag),this._clearTimeout();for(var t=0,e=this._opts.landmarkPois,i=e.length;t<i;t++)e[t].bShow=!1;this._opts.onstop&&this._opts.onstop(this)},h.prototype.pause=function(){clearInterval(this._intervalFlag),this._fromPause=!0,this._clearTimeout(),this._opts.onpause&&this._opts.onpause(this)},h.prototype.hideInfoWindow=function(){this._opts.showInfoWindow=!1,this._overlay&&(this._overlay._div.style.visibility="hidden")},h.prototype.showInfoWindow=function(){this._opts.showInfoWindow=!0,this._overlay&&(this._overlay._div.style.visibility="visible")},h.prototype.dispose=function(){clearInterval(this._intervalFlag),this._setTimeoutQuene&&this._clearTimeout(),this._map&&(this._map.removeOverlay(this._overlay),this._map.removeOverlay(this._marker))},o.object.extend(h.prototype,{_addMarker:function(t){this._marker&&(this.stop(),this._map.removeOverlay(this._marker),clearTimeout(this._timeoutFlag)),this._overlay&&this._map.removeOverlay(this._overlay);var e=new BMap.Marker(this._path[0]);this._opts.icon&&e.setIcon(this._opts.icon),this._map.addOverlay(e),e.setAnimation(BMAP_ANIMATION_DROP),this._marker=e},_addInfoWin:function(){var t=this;!u.prototype.initialize&&m();var e=new u(t._marker.getPosition(),t._opts.defaultContent);e.setRelatedClass(this),this._overlay=e,this._map.addOverlay(e),this._opts.showInfoWindow?this.showInfoWindow():this.hideInfoWindow()},_getMercator:function(t){return this._map.getMapType().getProjection().lngLatToPoint(t)},_getDistance:function(t,e){return Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2))},_move:function(t,e,i){var n=this,s=0,l=10,p=this._opts.speed/(1e3/l),d=this._projection.lngLatToPoint(t),_=this._projection.lngLatToPoint(e),c=Math.round(n._getDistance(d,_)/p);if(c<1){n._moveNext(++n.i);return}n._intervalFlag=setInterval(function(){if(s>=c){if(clearInterval(n._intervalFlag),n.i>n._path.length)return;n._moveNext(++n.i)}else{s++;var w=i(d.x,_.x,s,c),x=i(d.y,_.y,s,c),f=n._projection.pointToLngLat(new BMap.Pixel(w,x));if(s==1){var y=null;n.i-1>=0&&(y=n._path[n.i-1]),n._opts.enableRotation==!0&&n.setRotation(y,t,e),n._opts.autoView&&(n._map.getBounds().containsPoint(f)||n._map.setCenter(f))}n._marker.setPosition(f),n._setInfoWin(f)}},l)},setRotation:function(t,e,i){var n=this,s=0;if(e=n._map.pointToPixel(e),i=n._map.pointToPixel(i),i.x!=e.x){var l=(i.y-e.y)/(i.x-e.x),p=Math.atan(l);s=p*360/(2*Math.PI),i.x<e.x?s=-s+90+90:s=-s,n._marker.setRotation(-s)}else{var d=i.y-e.y,_=0;d>0?_=-1:_=1,n._marker.setRotation(-_*90)}},linePixellength:function(t,e){return Math.sqrt(Math.abs(t.x-e.x)*Math.abs(t.x-e.x)+Math.abs(t.y-e.y)*Math.abs(t.y-e.y))},pointToPoint:function(t,e){return Math.abs(t.x-e.x)*Math.abs(t.x-e.x)+Math.abs(t.y-e.y)*Math.abs(t.y-e.y)},_moveNext:function(t){var e=this;t<this._path.length-1?e._move(e._path[t],e._path[t+1],e._tween.linear):e.stop()},_setInfoWin:function(t){var e=this;e._overlay.setPosition(t,e._marker.getIcon().size);var i=e._troughPointIndex(t);i!=-1?(clearInterval(e._intervalFlag),e._overlay.setHtml(e._opts.landmarkPois[i].html),e._overlay.setPosition(t,e._marker.getIcon().size),e._pauseForView(i)):e._overlay.setHtml(e._opts.defaultContent)},_pauseForView:function(t){var e=this,i=setTimeout(function(){e._moveNext(++e.i)},e._opts.landmarkPois[t].pauseTime*1e3);e._setTimeoutQuene.push(i)},_clearTimeout:function(){for(var t in this._setTimeoutQuene)clearTimeout(this._setTimeoutQuene[t]);this._setTimeoutQuene.length=0},_tween:{linear:function(t,e,i,n){var s=t,l=e-t,p=i,d=n;return l*p/d+s}},_troughPointIndex:function(t){for(var e=this._opts.landmarkPois,i,n=0,s=e.length;n<s;n++)if(!e[n].bShow&&(i=this._map.getDistance(new BMap.Point(e[n].lng,e[n].lat),t),i<10))return e[n].bShow=!0,n;return-1}});function u(t,e){this._point=t,this._html=e}function m(){u.prototype=new BMap.Overlay,u.prototype.initialize=function(t){var e=this._div=o.dom.create("div",{style:"border:solid 1px #ccc;width:auto;min-width:50px;text-align:center;position:absolute;background:#fff;color:#000;font-size:12px;border-radius: 10px;padding:5px;white-space: nowrap;"});return e.innerHTML=this._html,t.getPanes().floatPane.appendChild(e),this._map=t,e},u.prototype.draw=function(){this.setPosition(this.lushuMain._marker.getPosition(),this.lushuMain._marker.getIcon().size)},o.object.extend(u.prototype,{setPosition:function(t,e){var i=this._map.pointToOverlayPixel(t),n=o.dom.getStyle(this._div,"width"),s=o.dom.getStyle(this._div,"height"),l=parseInt(this._div.clientWidth||n,10);parseInt(this._div.clientHeight||s,10),this._div.style.left=i.x-l/2+"px",this._div.style.bottom=-(i.y-e.height)+"px"},setHtml:function(t){this._div.innerHTML=t},setRelatedClass:function(t){this.lushuMain=t}})}return h})})(v);var b=v.exports;const S={name:"bm-lushu",render(r){},emits:["start","stop","pause"],mixins:[M("lushu")],props:{path:{type:Array,default:[]},landmarkPois:{type:Array,default(){return[]}},icon:{type:Object},speed:{type:Number,default:4e3},content:{type:String,default:""},autoView:{type:Boolean,default:!1},rotation:{type:Boolean,default:!1},infoWindow:{type:Boolean,default:!0},play:{type:Boolean,default:!0}},watch:{path:{handler(r){this.reload()},deep:!0},landmarkPois:{handler(r){this.reload()},deep:!0},icon:{handler(r){const{originInstance:a,content:o}=this,h=g(BMap,r);a._opts.icon=h,a._marker=h},deep:!0},speed(r){const{originInstance:a,content:o}=this;a._opts.speed=r},content(r){const{originInstance:a,infoWindow:o}=this;r&&o?a.showInfoWindow():a.hideInfoWindow(),a._opts.defaultContent=r,a._overlay&&a._overlay.setHtml(r)},autoView(r){const{originInstance:a,content:o}=this;a._opts.autoView=r},rotation(r){const{originInstance:a,content:o}=this;a._opts.enableRotation=r},infoWindow(r){const{originInstance:a,content:o}=this;a&&r&&o?a.showInfoWindow():a.hideInfoWindow()},play(r){const{originInstance:a}=this;r&&a?a.start():!this._isEnd&&a.pause()}},methods:{load(){const{BMap:r,map:a,path:o,landmarkPois:h,icon:u,speed:m,content:t,autoView:e,rotation:i,infoWindow:n,play:s}=this,l=this.originInstance=new b(a,o,{enableRotation:i,landmarkPois:h,showInfoWindow:n,defaultContent:t,icon:u&&g(r,u),speed:m,autoView:e,onstart:p=>{this._isEnd=!1,this.$emit("start")},onstop:p=>{this._isEnd=!0,this.$emit("stop")},onpause:p=>this.$emit("pause")});s&&o.length&&l.start(this),o.length&&(t&&n?l.showInfoWindow():l.hideInfoWindow())}}};export{S as default};
